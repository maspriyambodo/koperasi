<?php include 'h_tetap.php';$jum_kdangsur=0;$nomi=$result->c_d(keangka($_GET['nomi']));$jangka=$result->c_d($_GET['jangka']);$saldoa=$result->c_d(keangka($_GET['saldoa']));$blunas=$result->c_d(keangka($_GET['blunas']));$bungakk=$result->c_d(keangka($_GET['bungakk']));$alunas=$result->c_d(keangka($_GET['alunas']));$gaji=$result->c_d(keangka($_GET['gaji']));$produk=$result->c_d($_GET['produk']);$kdangsur=$result->c_d($_GET['kdangsur']);$jum_kdangsur=$result->c_d($_GET['jum_kdangsur']);$suku=$result->c_d($_GET['suku']);$kdpremi=$result->c_d($_GET['kdpremi']);$umur=age(date_sql($result->c_d($_GET['tglahir'])));$tenor_premi=0;$jumlah_period=$result->c_d($_GET['jumlah_period']);$jumbtl=$result->c_d(keangka($_GET['jumbtl']));$simpanan_pokok=$result->c_d(keangka($_GET['simpanan_pokok']));$simpanan_wajib=$result->c_d(keangka($_GET['simpanan_wajib']));if($kdpremi!=9){$hasil=$result->res("SELECT a.tenor_premi,a.jangka_waktu,a.umur,b.kode_asuransi,b.status_asuransi FROM tbl_premi a JOIN tbl_asuransi b on a.kode_asuransi=b.kode_asuransi WHERE b.kode_asuransi='$kdpremi' AND b.status_asuransi=1 AND a.jangka_waktu='$jangka' AND a.umur='$umur' LIMIT 1");if(!$hasil){$data['pesan']= $result->xpdata("");echo json_encode($data);exit();}if($result->num($hasil)!=0){$row = $result->row($hasil);$tenor_premi=$row['tenor_premi'];}else{$data['pesan'] = "Kode Asuransi : ".$kdpremi." Umur : ".$umur." Tahun [Tabel Tenor Premi Asuransi Belum Terdaftar!]";echo json_encode($data);exit();}}$hasil=$result->res("SELECT badm,bprovisi,bpremi,bmeterai,mplafon,bumur,htagih FROM debit1 WHERE kdproduk='$produk' LIMIT 1");if(!$hasil){$data['pesan']= $result->xpdata("");echo json_encode($data);exit();}if($result->num($hasil)!=0){$row = $result->row($hasil);$kdkop=$row['htagih'];if($kdkop==1){if($jangka<1 || $jangka>60){$data['pesan'] = "Jangka Waktu Tidak Sesuai [ Minimum 2 Bln Dan Max= 60 Bln ]";echo json_encode($data);exit();}}elseif($kdkop==2){if($jangka!=30 && $jangka!=60 && $jangka!=90 && $jangka!=120){$data['pesan'] = "Jangka Waktu Tidak Sesuai [ Minimum 30 Hari Dan Max=90 Hari ]";echo json_encode($data);exit();}}elseif($kdkop==3){if($jangka!=4 && $jangka!=8 && $jangka!=12 && $jangka!=16){$data['pesan'] = "Jangka Waktu Tidak Sesuai [ Minimum 4 Minggu Dan Max=16 Minggu ]";echo json_encode($data);exit();}}else{$data['pesan']="Skim Tagihan Belum Terdaftar ".$kdkop;echo json_encode($data);exit();}$adm=$row['badm'];$provi=$row['bprovisi'];$meterai=$row['bmeterai'];$mplafon=$row['mplafon'];$bumur=$row['bumur'];if($umur>$bumur){$data['pesan'] = 'Umur : '.$umur.'  Tahun, Maximum Umur : '.$bumur.' Tahun, Transaksi Batal';echo json_encode($data);exit();}$jumlunas = intval($blunas + $bungakk + $saldoa + $alunas);$mpremi = intval(($nomi * $tenor_premi) / 100 + 0.5);$mprovi = intval(($nomi * $provi) / 100 + 0.5);$mmadm = intval(($nomi * $adm) / 100 + 0.5);$jumbiaya = intval($mpremi + $mprovi + $mmadm + $meterai);if($produk=='KMP'){$mjangka=$jangka;$pokok = intval(ceil($nomi/$mjangka));}else{$pokok = intval(ceil($nomi/$jangka));}if($kdkop==2){$mjangka=intval($jangka/30);$bunga=intval(($nomi*$suku)/100+0.5);$bunga=intval(($bunga*$mjangka)/$jangka);}elseif($kdkop==3){$mjangka=intval($jangka/4);$bunga=intval(($nomi*$suku)/100+0.5);$bunga=intval(($bunga*$mjangka)/$jangka);}else{$bunga = intval(($nomi*$suku) / 100 + 0.5);}$madm=0;$total = intval($pokok + $bunga) / 1000;$madm = bulat_tag($total,$madm);$jumangsur = intval($pokok + $bunga + $madm);$max=intval(($jumangsur/$gaji)*100);if($max>$mplafon){$data['pesan'] = "Melebihi Plafond : ".$max.' % Transaksi Batal';echo json_encode($data);exit();}$jumbersih = intval($nomi - $jumbiaya - $jumlunas);$xjumangsur=0;$jum_period=0;if($produk=='KMP'){$jum_admx=intval(($madm*$jumlah_period));$jum_periodx=intval(($bunga*$jumlah_period));$jum_period=intval(($jum_periodx+$jum_admx));}if($kdangsur==0){$xjumangsur=intval($jumangsur*$jum_kdangsur);}$jumbiaya=$jumbiaya+$jum_period+$xjumangsur;$jumbersih =intval($nomi-$jumbiaya-$jumlunas-$jumbtl-$simpanan_pokok-$simpanan_wajib);if($jumbersih<1){$data['pesan']="Jumlah Diterima  : Rp. ".$jumbersih.'  Transaksi Batal';echo json_encode($data);exit();}$data['pokok'] = $pokok;$data['bunga'] = $bunga;$data['madm'] = $madm;$data['jumprovisi'] = $mprovi;$data['jumpremi'] = $mpremi;$data['jumadm'] = $mmadm;$data['meterai'] = $meterai;$data['jumpotong'] = $jumbiaya;$data['jumangsur'] = $jumangsur;$data['jumlunas'] = $jumlunas;$data['jumbersih'] = $jumbersih;$data['pot_angsuran'] = $xjumangsur;$data['tenor_premi'] = $tenor_premi;$data['umur'] = $umur;$data['jumrefund']=0; $data['jum_period']=$jum_period;$data['pesan'] = 'Sukses';echo json_encode($data);}else{$data['pesan'] = 'Kode Produk Belum Terdaftar!';echo json_encode($data);} ?>